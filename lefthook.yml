# spec: https://github.com/evilmartians/lefthook/blob/master/docs/full_guide.md

pre-commit:
  parallel: true
  commands:
    lint:
      glob: "{task,.hooks/*,*.{sh,bash,bats}}"
      run: shellcheck {staged_files}
    fmt:
      glob: "{task,.hooks/*,*.{sh,bash,bats}}"
      run: |
        git stash -q --keep-index &&
        shfmt -l -w {staged_files} &&
        git add -u && git stash pop -q
    test:
      glob: "{task,*.bats}"
      # see: https://github.com/evilmartians/lefthook/issues/228#issuecomment-924505331
      run: echo {staged_files} >/dev/null && task -o interleaved test

commit-msg:
  commands:
    commitlint:
      run: task commitlint -o interleaved -- -e -V
